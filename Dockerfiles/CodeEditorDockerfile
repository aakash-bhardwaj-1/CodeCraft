# Step 1: Build the React application
FROM node:18 AS build

# Set the working directory
WORKDIR /app

# Copy package.json and package-lock.json
COPY CodeEditor/package.json ../CodeEditor/package-lock.json ./

# Install dependencies
RUN npm install --legacy-peer-deps

# Copy the rest of the application code and configuration files
COPY CodeEditor/* .
#COPY CodeEditor/src ./src

# Build the React application
#RUN npm run build


# Step 2: Serve the React application using Nginx
#FROM nginx:alpine

# Copy the build output to the Nginx HTML directory
#COPY --from=build /app/build /usr/share/nginx/html

# Copy custom Nginx configuration file to the correct directory
#COPY CodeEditor/nginx.conf /etc/nginx/conf.d/default.conf

# Expose ports 80 (Nginx) and 5000 (Node.js)
EXPOSE 3000

#COPY CodeEditor/server.js ./server.js

# Start Nginx and Node.js using PM2
CMD ["sh", "-c", "node server.js && npm start"]

